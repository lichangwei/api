{"ast":null,"code":"var __jsx = React.createElement;\nimport React from 'react';\nimport './common.less';\nimport './TransformWeChatImageToBackground.less';\nexport default function App() {\n  const onChange = React.useCallback(async e => {\n    const node = document.getElementById('target');\n    node.value = await transform(e.target.value);\n  }, []);\n  const copy = React.useCallback(e => {\n    const node = document.getElementById('target');\n    node.select();\n    document.execCommand('copy');\n    node.setSelectionRange(0, 0);\n    node.blur();\n  }, []);\n  return __jsx(React.Fragment, null, __jsx(\"h2\", null, \"\\u5FAE\\u4FE1\\u516C\\u4F17\\u53F7\\u6587\\u7AE0\\u5B9E\\u73B0\\u9632\\u89E6\\u78B0\\u6548\\u679C\"), __jsx(\"div\", null, \"\\u53C2\\u8003\\u6587\\u7AE0\\uFF1A\", __jsx(\"a\", {\n    href: \"https://mp.weixin.qq.com/s?__biz=MzIyNTgyNzEyNQ==&mid=2247484782&idx=1&sn=66c031895c3b24f695a5048c77c74916&chksm=e8788534df0f0c228144454e649e8609e5ac7e2dd4bd78a3b820dddc2b48e809993b5d1abc33&mpshare=1&scene=1&srcid=0107sG49sXnYZaNla2cs1eKt&sharer_sharetime=1578405801189&sharer_shareid=165df3fe89b08ef85873e284bb6e529c&rd2werd=1#wechat_redirect\",\n    target: \"_blank\"\n  }, \"\\u8DDF\\u82F9\\u679C\\u5B66\\u4E60\\u5FAE\\u4FE1\\u516C\\u4F17\\u53F7\\u6392\\u7248\")), __jsx(\"div\", {\n    className: \"convertor\"\n  }, __jsx(\"section\", {\n    className: \"source\"\n  }, __jsx(\"h3\", null, \"\\u4FEE\\u6539\\u524D\"), __jsx(\"textarea\", {\n    onChange: onChange,\n    placeholder: \"\\u628A\\u6E90\\u4EE3\\u7801\\u7C98\\u8D34\\u5230\\u8FD9\\u91CC\"\n  })), __jsx(\"section\", {\n    className: \"target\"\n  }, __jsx(\"div\", null, __jsx(\"h3\", null, \"\\u4FEE\\u6539\\u540E\"), __jsx(\"div\", {\n    className: \"action\"\n  }, __jsx(\"button\", {\n    type: \"button\",\n    onClick: copy\n  }, \"\\u590D\\u5236\"))), __jsx(\"textarea\", {\n    id: \"target\"\n  }))));\n}\n\nasync function transform(html) {\n  const container = document.createElement('div');\n  container.innerHTML = html;\n  const nodes = Array.from(container.querySelectorAll('img'));\n  await Promise.all(nodes.map(node => {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n\n      img.onload = () => {\n        const div = document.createElement('div');\n        const paddingTop = img.naturalHeight / img.naturalWidth * 100;\n        div.style.cssText = `padding-top: ${paddingTop}%; background-image: url(\"${img.src}\"); background-size: 100%; background-repeat: no-repeat;`;\n        node.parentElement.replaceChild(div, node);\n        return resolve();\n      };\n\n      img.onerror = reject;\n      img.src = node.src || node.getAttribute('src') || node.getAttribute('data-src');\n    });\n  }));\n  return container.innerHTML;\n}","map":{"version":3,"sources":["/Users/gaiaworks/workspace/api/nextjs/pages/views/TransformWeChatImageToBackground.tsx"],"names":["React","App","onChange","useCallback","e","node","document","getElementById","value","transform","target","copy","select","execCommand","setSelectionRange","blur","html","container","createElement","innerHTML","nodes","Array","from","querySelectorAll","Promise","all","map","resolve","reject","img","Image","onload","div","paddingTop","naturalHeight","naturalWidth","style","cssText","src","parentElement","replaceChild","onerror","getAttribute"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './common.less';\nimport './TransformWeChatImageToBackground.less';\n\nexport default function App() {\n  const onChange = React.useCallback(async (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    const node = document.getElementById('target') as HTMLTextAreaElement;\n    node.value = await transform(e.target.value);\n  }, []);\n  const copy = React.useCallback((e: React.MouseEvent<HTMLButtonElement>) => {\n    const node = document.getElementById('target') as HTMLTextAreaElement;\n    node.select();\n    document.execCommand('copy');\n    node.setSelectionRange(0, 0);\n    node.blur();\n  }, []);\n  return (\n    <>\n      <h2>微信公众号文章实现防触碰效果</h2>\n      <div>\n        参考文章：\n        <a\n          href=\"https://mp.weixin.qq.com/s?__biz=MzIyNTgyNzEyNQ==&mid=2247484782&idx=1&sn=66c031895c3b24f695a5048c77c74916&chksm=e8788534df0f0c228144454e649e8609e5ac7e2dd4bd78a3b820dddc2b48e809993b5d1abc33&mpshare=1&scene=1&srcid=0107sG49sXnYZaNla2cs1eKt&sharer_sharetime=1578405801189&sharer_shareid=165df3fe89b08ef85873e284bb6e529c&rd2werd=1#wechat_redirect\"\n          target=\"_blank\"\n        >\n          跟苹果学习微信公众号排版\n        </a>\n      </div>\n      <div className=\"convertor\">\n        <section className=\"source\">\n          <h3>修改前</h3>\n          <textarea onChange={onChange} placeholder=\"把源代码粘贴到这里\"></textarea>\n        </section>\n        <section className=\"target\">\n          <div>\n            <h3>修改后</h3>\n            <div className=\"action\">\n              <button type=\"button\" onClick={copy}>\n                复制\n              </button>\n            </div>\n          </div>\n          <textarea id=\"target\"></textarea>\n        </section>\n      </div>\n    </>\n  );\n}\n\nasync function transform(html: string): Promise<string> {\n  const container = document.createElement('div');\n  container.innerHTML = html;\n  const nodes = Array.from(container.querySelectorAll('img'));\n  await Promise.all(\n    nodes.map((node: HTMLImageElement) => {\n      return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.onload = () => {\n          const div = document.createElement('div');\n          const paddingTop = (img.naturalHeight / img.naturalWidth) * 100;\n          div.style.cssText = `padding-top: ${paddingTop}%; background-image: url(\"${img.src}\"); background-size: 100%; background-repeat: no-repeat;`;\n          node.parentElement.replaceChild(div, node);\n          return resolve();\n        };\n        img.onerror = reject;\n        img.src = node.src || node.getAttribute('src') || node.getAttribute('data-src');\n      });\n    })\n  );\n  return container.innerHTML;\n}\n"]},"metadata":{},"sourceType":"module"}